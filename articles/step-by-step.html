<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Run bistro step-by-step • bistro</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run bistro step-by-step">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bistro</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/bistro.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/step-by-step.html">Run bistro step-by-step</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/duke-malaria-collaboratory/bistro/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Run bistro step-by-step</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/duke-malaria-collaboratory/bistro/blob/main/vignettes/step-by-step.Rmd" class="external-link"><code>vignettes/step-by-step.Rmd</code></a></small>
      <div class="d-none name"><code>step-by-step.Rmd</code></div>
    </div>

    
    
<p>If you haven’t yet, please check out <code><a href="../articles/bistro.html">vignette("bistro")</a></code>
before reading this vignette. It will provide you with more background
and context, and take you through the outputs in more detail than we do
here. Then if you want to learn how to run sub-functions of bistro
individually, or run bistro step-by-step, you’re in the right place.</p>
<p>We will go through the following steps to run bistro step-by-step
using the example data provided in the <code>bistro</code> package:</p>
<ul>
<li><code><a href="../reference/calc_allele_freqs.html">calc_allele_freqs()</a></code></li>
<li><code><a href="../reference/prep_bloodmeal_profiles.html">prep_bloodmeal_profiles()</a></code></li>
<li><code><a href="../reference/prep_human_profiles.html">prep_human_profiles()</a></code></li>
<li><code><a href="../reference/calc_log10_lrs.html">calc_log10_lrs()</a></code></li>
<li><code><a href="../reference/identify_matches.html">identify_matches()</a></code></li>
</ul>
<p>First, you’ll have to load the <code>bistro</code> library:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://duke-malaria-collaboratory.github.io/bistro/">bistro</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: euroformix</span></span></code></pre></div>
<div class="section level2">
<h2 id="calculate-human-population-allele-frequencies">Calculate human population allele frequencies<a class="anchor" aria-label="anchor" href="#calculate-human-population-allele-frequencies"></a>
</h2>
<p>If needed, you can first calculate population allele frequencies from
your human profile database:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop_freqs_computed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_allele_freqs.html">calc_allele_freqs</a></span><span class="op">(</span><span class="va">human_profiles</span><span class="op">)</span></span></code></pre></div>
<p>We will use the built-in population allele frequencies here since
they are more accurate than computing allele frequencies for only the
three example profiles in <code>human_profiles</code>.</p>
</div>
<div class="section level2">
<h2 id="prepare-input-str-profiles">Prepare input STR profiles<a class="anchor" aria-label="anchor" href="#prepare-input-str-profiles"></a>
</h2>
<p>Before calculating log10LRs, you must ensure that the bloodmeal and
human profiles are prepared correctly. You can do this using
<code><a href="../reference/prep_bloodmeal_profiles.html">prep_bloodmeal_profiles()</a></code> and
<code><a href="../reference/prep_human_profiles.html">prep_human_profiles()</a></code>, respectively.</p>
<p>Both functions:</p>
<ul>
<li>Removes markers the user does not want to use</li>
<li>Removes duplicate rows to ensure that homozygous alleles are only
included once</li>
</ul>
<p><code><a href="../reference/prep_bloodmeal_profiles.html">prep_bloodmeal_profiles()</a></code> also optionally filters peakes
below a user-defined threshold</p>
<p><code><a href="../reference/prep_human_profiles.html">prep_human_profiles()</a></code> also optionally removes identical
twins (which cannot be resolved)</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bm_profs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_bloodmeal_profiles.html">prep_bloodmeal_profiles</a></span><span class="op">(</span><span class="va">bloodmeal_profiles</span>, peak_thresh <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="co">#&gt; Removing 6 peaks under the threshold of 200 RFU.</span></span>
<span><span class="co">#&gt; For 1/4 bloodmeal ids, all peaks are below the threshold</span></span>
<span><span class="va">hu_profs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_human_profiles.html">prep_human_profiles</a></span><span class="op">(</span><span class="va">human_profiles</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calculate-log10lrs-for-bloodmeal-human-pairs">Calculate log10LRs for bloodmeal-human pairs<a class="anchor" aria-label="anchor" href="#calculate-log10lrs-for-bloodmeal-human-pairs"></a>
</h2>
<p>Next, you can use the prepared profiles to compute log10LRs for each
bloodmeal-human pair (or a subset of pairs). Note that to identify
matches, you will have to have the log10LRs between each bloodmeal and
all human profiles in the reference database.</p>
<p>Here is an example of how to compute the log10LRs for one bloodmeal
and all humans in the database:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log10_lrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_log10_lrs.html">calc_log10_lrs</a></span><span class="op">(</span><span class="va">bm_profs</span>,</span>
<span>  <span class="va">hu_profs</span>,</span>
<span>  bloodmeal_ids <span class="op">=</span> <span class="st">"evid1"</span>,</span>
<span>  pop_allele_freqs <span class="op">=</span> <span class="va">pop_allele_freqs</span>,</span>
<span>  kit <span class="op">=</span> <span class="st">"ESX17"</span>,</span>
<span>  peak_thresh <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; 1/17 markers in kit but not in bloodmeal_profiles: AMEL</span></span>
<span><span class="co">#&gt; 1/17 markers in kit but not in human_profiles: AMEL</span></span>
<span><span class="co">#&gt; # bloodmeal ids: 1</span></span>
<span><span class="co">#&gt; # human ids: 3</span></span>
<span><span class="co">#&gt; Bloodmeal id 1/1</span></span>
<span><span class="co">#&gt; Human id 1/3</span></span>
<span><span class="co">#&gt; Human id 2/3</span></span>
<span><span class="co">#&gt; Human id 3/3</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="identify-bloodmeal-human-matches">Identify bloodmeal-human matches<a class="anchor" aria-label="anchor" href="#identify-bloodmeal-human-matches"></a>
</h2>
<p>Next, we can identify matches to the bloodmeal:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matches</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/identify_matches.html">identify_matches</a></span><span class="op">(</span><span class="va">log10_lrs</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zena Lapp, Christine Markwalter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
