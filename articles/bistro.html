<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="bistro">
<title>Introduction to using bistro • bistro</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to using bistro">
<meta property="og:description" content="bistro">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">bistro</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/bistro.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/duke-malaria-collaboratory/bistro/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to using bistro</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/duke-malaria-collaboratory/bistro/blob/HEAD/vignettes/bistro.Rmd" class="external-link"><code>vignettes/bistro.Rmd</code></a></small>
      <div class="d-none name"><code>bistro.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-bistro-algorithm">The bistro algorithm<a class="anchor" aria-label="anchor" href="#the-bistro-algorithm"></a>
</h2>
<p>bistro is an algorithm, an R package, and a function within said R
package. It employs methods from forensics to identify matches between
bloodmeals and the people they bit using short tandem repeat (STR)
profiles of human blood from freshly fed bloodmeals and from people. It
can be used to match multi-source bloodmeals and bloodmeals with
incomplete STR profiles. Note that while you can use it for matching any
STR profiles for research purposes, we very much <em>do not</em>
recommend using it for forensic purposes. For more details about the
algorithm, please refer to the bistro manuscript (will add link once
it’s posted).</p>
<p>A core part of the algorithm is the <a href="https://github.com/oyvble/euroformix/blob/master/R/contLikSearch.R" class="external-link"><code>contLikSearch()</code></a>
function from the <code>euroformix</code> package, which is used to
calculate log10 likelihood ratios (log10LRs). The numerator of the
log10LR is the likelihood that the person was bitten by the vector and
the denominator is the likelihood that someone else was bitten by the
vector. Here is more information about euroformix: - Manuscript: <a href="https://pubmed.ncbi.nlm.nih.gov/26720812/" class="external-link">EuroForMix: An open
source software based on a continuous model to evaluate STR DNA profiles
from a mixture of contributors with artefacts</a> - <a href="https://github.com/oyvble/euroformix" class="external-link">GitHub</a> - <a href="http://www.euroformix.com/" class="external-link">Website that explains GUI</a></p>
<p>bistro uses the log10LRs to identify bloodmeal-human matches using a
per-bloodmeal dynamic threshold approach.</p>
</div>
<div class="section level2">
<h2 id="installing-the-bistro-r-package">Installing the <code>bistro</code> R package<a class="anchor" aria-label="anchor" href="#installing-the-bistro-r-package"></a>
</h2>
<p>To install <code>bistro</code>, run the following commands:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span> <span class="co"># install devtools if needed</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"duke-malaria-collaboratory/bistro"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="getting-started-with-bistro">Getting started with <code>bistro</code><a class="anchor" aria-label="anchor" href="#getting-started-with-bistro"></a>
</h2>
<p>The most important function in <code>bistro</code> is
<code><a href="../reference/bistro.html">bistro()</a></code>. This document will take you through all of the
required and optional inputs, as well as the output.</p>
<p>In summary, you must provide:</p>
<ul>
<li>Bloodmeal STR profiles</li>
<li>Human STR profiles</li>
<li>The STR genotyping kit name</li>
<li>An allele peak height threshold (in relative fluorescence units,
RFUs) for the bloodmeal STR profiles</li>
</ul>
<p>The function outputs matches for each bloodmeal-human pair.</p>
<p>To follow along with the vignette, first load
<code>bistro</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://duke-malaria-collaboratory.github.io/bistro/">bistro</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: euroformix</span></span></code></pre></div>
<p>Note that when we load <code>bistro</code>, we also load <a href="https://github.com/oyvble/euroformix/" class="external-link"><code>euroformix</code></a>
because <code>bistro</code> depends on the <code>euroformix</code>
package.</p>
</div>
<div class="section level2">
<h2 id="required-inputs">Required inputs<a class="anchor" aria-label="anchor" href="#required-inputs"></a>
</h2>
<p>Before we run <code><a href="../reference/bistro.html">bistro()</a></code> using example data, let’s learn
more about the required inputs.</p>
<p>Two required, and one optional but often recommended, datasets are
required to run <code><a href="../reference/bistro.html">bistro()</a></code>: bloodmeal and human STR profiles
are required, and human population allele frequencies are optional. The
other two required inputs are the STR genotyping kit name and the
bloodmeal STR allele peak height threshold.</p>
<div class="section level3">
<h3 id="bloodmeal-str-profiles-bloodmeal_profiles">Bloodmeal STR profiles (<code>bloodmeal_profiles</code>)<a class="anchor" aria-label="anchor" href="#bloodmeal-str-profiles-bloodmeal_profiles"></a>
</h3>
<p>The bloodmeal STR profiles dataset should have one row per allele for
each bloodmeal and marker, and include the allele peak height.
Homozygous markers should only be included once (i.e. as one row). It
must have four columns named SampleName, Marker, Allele, and Height.
Here is an example included with <code>bistro</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bloodmeal_profiles</span><span class="op">)</span></span>
<span><span class="co">#&gt;   SampleName   Marker Allele Height</span></span>
<span><span class="co">#&gt; 1      evid1     AMEL      X   2136</span></span>
<span><span class="co">#&gt; 2      evid1     AMEL      Y   1015</span></span>
<span><span class="co">#&gt; 3      evid1 D10S1248     13   1856</span></span>
<span><span class="co">#&gt; 4      evid1 D10S1248     14    155</span></span>
<span><span class="co">#&gt; 5      evid1 D10S1248     15   1045</span></span>
<span><span class="co">#&gt; 6      evid1  D12S391     18    297</span></span></code></pre></div>
<p>In this example dataset, we have 4 different bloodmeals:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">bloodmeal_profiles</span><span class="op">$</span><span class="va">SampleName</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "evid1" "evid2" "evid3" "evid4"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="human-str-profiles-human_profiles">Human STR profiles (<code>human_profiles</code>)<a class="anchor" aria-label="anchor" href="#human-str-profiles-human_profiles"></a>
</h3>
<p>The human STR profiles dataset takes a similar format to the
bloodmeal STR profiles dataset - it should have one row per allele for
each human and marker, but does not require peak heights. Again,
homozygous markers should only be included once. The dataset must have
three columns named SampleName, Marker, and Allele. Here is an
example:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">human_profiles</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         SampleName   Marker Allele</span></span>
<span><span class="co">#&gt; 1 00-JP0001-14_20142342311_NO-3241     AMEL      X</span></span>
<span><span class="co">#&gt; 2 00-JP0001-14_20142342311_NO-3241     AMEL      Y</span></span>
<span><span class="co">#&gt; 3 00-JP0001-14_20142342311_NO-3241 D10S1248     12</span></span>
<span><span class="co">#&gt; 4 00-JP0001-14_20142342311_NO-3241 D10S1248     13</span></span>
<span><span class="co">#&gt; 5 00-JP0001-14_20142342311_NO-3241  D12S391     17</span></span>
<span><span class="co">#&gt; 6 00-JP0001-14_20142342311_NO-3241  D12S391     18</span></span></code></pre></div>
<p>In this example dataset, we have 3 different human profiles:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">human_profiles</span><span class="op">$</span><span class="va">SampleName</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "00-JP0001-14_20142342311_NO-3241" "P1"                              </span></span>
<span><span class="co">#&gt; [3] "P2"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="str-genotyping-kit-kit">STR genotyping kit (<code>kit</code>)<a class="anchor" aria-label="anchor" href="#str-genotyping-kit-kit"></a>
</h3>
<p><code>bistro</code> requires as input the STR genotyping kit name.
The <code>euroformix</code> package includes kit parameters for 23
common STR genotyping kits. It also includes a handy function to list
all available kits:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/euroformix/man/getKit.html" class="external-link">getKit</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "testkit"       "ESX16"         "ESX17"         "ESX17Fast"    </span></span>
<span><span class="co">#&gt;  [5] "ESI17Fast"     "Fusion"        "Fusion 6C"     "SGMPlus"      </span></span>
<span><span class="co">#&gt;  [9] "Identifiler"   "NGM"           "NGMSElect"     "NGMDetect"    </span></span>
<span><span class="co">#&gt; [13] "GlobalFiler"   "PowerPlex16"   "PowerPlex21"   "24plex"       </span></span>
<span><span class="co">#&gt; [17] "ESSPlex"       "ESSplexPlus"   "ESSplexSEPlus" "ESSplexSEQS"  </span></span>
<span><span class="co">#&gt; [21] "ForenSeq"      "VFP"           "MiniFiler"</span></span></code></pre></div>
<p>If the kit you used to genotype samples is not available in the
defaults, you will have to modify <code>kit.txt</code> within the
<code>euroformix</code> package with the appropriate kit parameters. The
required parameters can usually be found in the kit manufacturer’s
documentation or or on their website.</p>
</div>
<div class="section level3">
<h3 id="bloodmeal-allele-peak-threshold-peak_thresh">Bloodmeal allele peak threshold (<code>peak_thresh</code>)<a class="anchor" aria-label="anchor" href="#bloodmeal-allele-peak-threshold-peak_thresh"></a>
</h3>
<p><code><a href="../reference/bistro.html">bistro()</a></code> also requires a bloodmeal allele peak threshold
(in RFUs) to be provided. All peaks with heights below this threshold
will be removed before matching. If prior filtering was performed on the
bloodmeal profiles based on peak height, then this number should be
equal to or greater than that threshold.</p>
</div>
<div class="section level3">
<h3 id="human-population-allele-frequencies-pop_allele_freqs">Human population allele frequencies
(<code>pop_allele_freqs</code>)<a class="anchor" aria-label="anchor" href="#human-population-allele-frequencies-pop_allele_freqs"></a>
</h3>
<p>Human population frequencies for each allele at each locus may be
supplied. If you would prefer, population allele frequencies can be
computed from the human STR profiles (see below for more details). Note
that the latter option is not suggested when a small set of human
reference profiles is being used.</p>
<p>The euroformix <a href="http://www.euroformix.com/?q=data" class="external-link">website</a> provides some
publicly available population frequency datasets. Additionally, you can
get United States population allele frequencies for many alleles from <a href="https://strbase.nist.gov/Information/NIST_Population_Data" class="external-link">NIST</a>.</p>
<p>If you would like to input population allele frequencies, the dataset
should contain one column for each STR marker and one row for each
allele. The alleles should be listed in the first column of the dataset
and the column should be named “Allele”. The entries for each
marker-allele combination are the population allele frequency or NA if
that allele does not exist for that marker. Here is an example with the
loci from the PowerPlex ESX 17 System (ESX17) kit.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pop_allele_freqs</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Allele D3S1358        TH01 D21S11       D18S51 D10S1248 D1S1656 D2S1338</span></span>
<span><span class="co">#&gt; 1    5.0      NA 0.002598441     NA           NA       NA      NA      NA</span></span>
<span><span class="co">#&gt; 2    6.0      NA 0.209274435     NA           NA       NA      NA      NA</span></span>
<span><span class="co">#&gt; 3    6.3      NA          NA     NA           NA       NA      NA      NA</span></span>
<span><span class="co">#&gt; 4    7.0      NA 0.212472516     NA 0.0008984726       NA      NA      NA</span></span>
<span><span class="co">#&gt; 5    8.0      NA 0.083649810     NA           NA       NA      NA      NA</span></span>
<span><span class="co">#&gt; 6    8.2      NA          NA     NA           NA       NA      NA      NA</span></span>
<span><span class="co">#&gt;        D16S539 D22S1045 VWA    D8S1179 FGA D2S441 D12S391 D19S433        SE33</span></span>
<span><span class="co">#&gt; 1           NA       NA  NA         NA  NA     NA      NA      NA          NA</span></span>
<span><span class="co">#&gt; 2 0.0008992806       NA  NA         NA  NA     NA      NA      NA          NA</span></span>
<span><span class="co">#&gt; 3           NA       NA  NA         NA  NA     NA      NA      NA          NA</span></span>
<span><span class="co">#&gt; 4           NA       NA  NA         NA  NA     NA      NA      NA          NA</span></span>
<span><span class="co">#&gt; 5 0.0086930456       NA  NA 0.01130226  NA     NA      NA      NA          NA</span></span>
<span><span class="co">#&gt; 6           NA       NA  NA         NA  NA     NA      NA      NA 0.002506945</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="running-bistro">Running <code>bistro()</code><a class="anchor" aria-label="anchor" href="#running-bistro"></a>
</h2>
<p>Now you have enough background to run <code><a href="../reference/bistro.html">bistro()</a></code>, so let’s
test it out using the example data included in the package:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bistro_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bistro.html">bistro</a></span><span class="op">(</span></span>
<span>  bloodmeal_profiles <span class="op">=</span> <span class="va">bloodmeal_profiles</span>,</span>
<span>  human_profiles <span class="op">=</span> <span class="va">human_profiles</span>,</span>
<span>  pop_allele_freqs <span class="op">=</span> <span class="va">pop_allele_freqs</span>,</span>
<span>  kit <span class="op">=</span> <span class="st">"ESX17"</span>,</span>
<span>  peak_thresh <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; 1/17 markers in kit but not in pop_allele_freqs: AMEL</span></span>
<span><span class="co">#&gt; Formatting bloodmeal profiles</span></span>
<span><span class="co">#&gt; Removing 6 peaks under the threshold of 200 RFU.</span></span>
<span><span class="co">#&gt; For 1/4 bloodmeal ids, all peaks are below the threshold</span></span>
<span><span class="co">#&gt; Formatting human profiles</span></span>
<span><span class="co">#&gt; Calculating log10LRs</span></span>
<span><span class="co">#&gt; # bloodmeal ids: 4</span></span>
<span><span class="co">#&gt; # human ids: 3</span></span>
<span><span class="co">#&gt; Bloodmeal id 1/4</span></span>
<span><span class="co">#&gt; Human id 1/3</span></span>
<span><span class="co">#&gt; Human id 2/3</span></span>
<span><span class="co">#&gt; Human id 3/3</span></span>
<span><span class="co">#&gt; Bloodmeal id 2/4</span></span>
<span><span class="co">#&gt; Human id 1/3</span></span>
<span><span class="co">#&gt; Human id 2/3</span></span>
<span><span class="co">#&gt; Human id 3/3</span></span>
<span><span class="co">#&gt; Bloodmeal id 3/4</span></span>
<span><span class="co">#&gt; Human id 1/3</span></span>
<span><span class="co">#&gt; Human id 2/3</span></span>
<span><span class="co">#&gt; Human id 3/3</span></span>
<span><span class="co">#&gt; Bloodmeal id 4/4</span></span>
<span><span class="co">#&gt; Human id 1/3</span></span>
<span><span class="co">#&gt; Human id 2/3</span></span>
<span><span class="co">#&gt; Human id 3/3</span></span>
<span><span class="co">#&gt; Identifying matches</span></span></code></pre></div>
<p>You’ll notice a bunch of messages print out to the screen:</p>
<ul>
<li>One of the markers (AMEL) is in the kit but not in
<code>pop_allele_freqs</code>.</li>
<li>6 peaks under the 200 RFU threshold were removed, and after
filtering one of the bloodmeals did not have any peaks remaining above
the threshold.</li>
<li>Notification that log10LRs (log10 likelihood ratios) are being
calculated for each bloodmeal-human pair (for 4 bloodmeals and 3
humans). This can take a while, so the progress is also printed
out.</li>
<li>Notification that matches are being identified.</li>
</ul>
<p>Let’s take a look at the output:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bistro_output</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 8</span></span></span>
<span><span class="co">#&gt;   bloodmeal_id locus_count est_noc match human_id log10_lr notes      thresh_low</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> evid1                 17       2 yes   P1           21.8 passed al…        9.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> evid1                 17       2 yes   P2           10.3 passed al…        9.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> evid2                  1       2 no    <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   no shared…       <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> evid3                  8       1 no    <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   all log10…       <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> evid4                  0       0 no    <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   no peaks …       <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>The output contains 8 columns:</p>
<ul>
<li>
<code>bloodmeal_id</code>: bloodmeal sample name.</li>
<li>
<code>est_noc</code>: estimated number of contributors (NOCs) to the
bloodmeal. When this equals one, it’s predicted to be a single-source
bloodmeal; when it is greater than one, it’s predicted to be a
multi-source bloodmeal. Note that sources here mean humans only.</li>
<li>
<code>locus_count</code>: number of loci STR-typed in the
bloodmeal.</li>
<li>
<code>match</code>: whether the bloodmeal STR profile matched to a
human in the database (yes or no).</li>
<li>
<code>human_id</code>: human match for the bloodmeal (NA if no
match).</li>
<li>
<code>log10_lr</code>: log10 likelihood ratio of the bloodmeal-human
match (NA if no match). The numerator of the log10LR is the likelihood
that the person was bitten by the bloodmeal and the denominator is the
likelihood that someone else was bitten by the bloodmeal.</li>
<li>
<code>notes</code>: why the bloodmeal does or doesn’t have a match
(see below for more details).</li>
<li>
<code>thresh_low</code>: log10LR threshold at which the match was
made.</li>
</ul>
<p>An important thing to notice is that, even though we have only 4
bloodmeals, there are 5 rows in the output dataset. This is because,
while each bloodmeal will appear at least once in the dataset, multiple
rows are present for bloodmeals that match to multiple people (one row
per match). For example, here, evid1 matches to 2 different people (P1
and P2) Please keep this in mind when performing data analysis.</p>
<p>The notes column provides more information on why there was or was
not a match:</p>
<ul>
<li>passed all filters: there was a match.</li>
<li>&gt; min NOC matches: there were more matches than expected and they
could not be resolved. This can happen when there are closely related
people in the human reference dataset.</li>
<li>no shared alleles: no people in the human reference dataset had
alleles that overlapped with the alleles in the bloodmeal.</li>
<li>all log10LRs &lt; 1.5: none of the log10LRs were high enough to be
considered a match.</li>
<li>euroformix error: the <code><a href="https://rdrr.io/pkg/euroformix/man/contLikSearch.html" class="external-link">euroformix::contLikSearch()</a></code>
function did not run successfully. This often happens with very
incomplete bloodmeal profiles (i.e. where only a few markers were
succesffuly STR-typed).</li>
<li>no peaks above threshold: all bloodmeal STR peaks were below the
peak height threshold.</li>
<li>timed out: log-likelihood took too long to calculate. If you want to
give it more time, you can modify the <code>time_limit</code> argument
(see below).</li>
</ul>
</div>
<div class="section level2">
<h2 id="using-computed-population-allele-frequencies">Using computed population allele frequencies<a class="anchor" aria-label="anchor" href="#using-computed-population-allele-frequencies"></a>
</h2>
<p>If you want to have the population allele frequencies computed from
the inputted human reference profiles, you must set
<code>calc_allele_freqs = TRUE</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bistro.html">bistro</a></span><span class="op">(</span></span>
<span>  bloodmeal_profiles <span class="op">=</span> <span class="va">bloodmeal_profiles</span>,</span>
<span>  human_profiles <span class="op">=</span> <span class="va">human_profiles</span>,</span>
<span>  calc_allele_freqs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  kit <span class="op">=</span> <span class="st">"ESX17"</span>,</span>
<span>  peak_thresh <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that, while we use the builtin dataset as an example here, we do
not recommend using this method for a human dataset with only 3 people.
An example of when it may make sense is if you have a relatively
comprehensive set of human reference profiles for your study site.</p>
</div>
<div class="section level2">
<h2 id="running-bistro-on-a-subset-of-samples">Running <code>bistro()</code> on a subset of samples<a class="anchor" aria-label="anchor" href="#running-bistro-on-a-subset-of-samples"></a>
</h2>
<p><code><a href="../reference/bistro.html">bistro()</a></code> can take a long time to run, especially if you
have many samples or a closely related reference population. Therefore,
before running it with all of your samples, we highly recommend testing
it out on a small subset of samples to make sure everything is working
as you expect. To do this, you can use the <code>bloodmeal_ids</code>
and <code>human_ids</code> arguments to tell <code><a href="../reference/bistro.html">bistro()</a></code> what
ids you want to compare:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bistro.html">bistro</a></span><span class="op">(</span></span>
<span>  bloodmeal_profiles <span class="op">=</span> <span class="va">bloodmeal_profiles</span>,</span>
<span>  human_profiles <span class="op">=</span> <span class="va">human_profiles</span>,</span>
<span>  pop_allele_freqs <span class="op">=</span> <span class="va">pop_allele_freqs</span>,</span>
<span>  kit <span class="op">=</span> <span class="st">"ESX17"</span>,</span>
<span>  peak_thresh <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  bloodmeal_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"evid1"</span>, <span class="st">"evid2"</span><span class="op">)</span>,</span>
<span>  human_ids <span class="op">=</span> <span class="st">"P1"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This can also be useful if you would like to parallelize
<code><a href="../reference/bistro.html">bistro()</a></code>, for example by using a workflow manager such as
Snakemake or NextFlow. If you’d like to try it out, <a href="https://github.com/duke-malaria-collaboratory/bistro_pipeline" class="external-link">here</a>
is a template Snakemake pipeline for running bistro. We highly recommend
doing this if you are planning to run it on many samples.</p>
</div>
<div class="section level2">
<h2 id="other-arguments">Other arguments<a class="anchor" aria-label="anchor" href="#other-arguments"></a>
</h2>
<p>Other arguments you can modify when running <code><a href="../reference/bistro.html">bistro()</a></code>
include:</p>
<p>Used by <code>bistro</code>:</p>
<ul>
<li>
<code>rm_twins</code>: whether or not to remove identical STR
profiles that are likely twins prior to identifying matches. Note that
matches with these people cannot be resolved (default: TRUE)</li>
<li>
<code>time_limit</code>: longest amount of time allowed to calculate
the log-likelihood for one bloodmeal-human pair, in minutes (default:
3)</li>
</ul>
<p>Used by <code><a href="https://rdrr.io/pkg/euroformix/man/contLikSearch.html" class="external-link">euroformix::contLikSearch()</a></code> when calculating
log-likelihoods:</p>
<ul>
<li>
<code>model_degrad</code>: whether or not to model peak degradation
(default: TRUE)</li>
<li>
<code>model_bw_stutt</code> and <code>model_fw_stutt</code>: whether
or not to model peak backward and forward stutter (default: FALSE)</li>
<li>
<code>difftol</code>: difference tolerance in log-likelihood across
2 iterations (default: 1)</li>
<li>
<code>threads</code>: number of threads to use when computing
log-likelihoods (default: 4)</li>
<li>
<code>seed</code>: seed for reproducible results (default: 1)</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Zena Lapp, Christine Markwalter.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
